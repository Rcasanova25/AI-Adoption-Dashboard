"""AI Adoption Dashboard - Refactored Modular Version."""\n\nfrom typing import Any, Dict, Optional\n\nimport pandas as pd\nimport streamlit as st\n\n# Import components\nfrom components.accessibility import AccessibilityManager, create_accessible_dashboard_layout\nfrom components.competitive_assessor import CompetitiveAssessor\n\n# Import economic insights\nfrom components.economic_insights import EconomicInsights\nfrom components.ui.metric_card import render_metric_card\nfrom components.ui.theme import ThemeManager\nfrom components.view_enhancements import ViewEnhancements\n\n# Import data management\nfrom data.data_manager import DataManager, create_optimized_manager\nfrom performance.cache_manager import get_cache\nfrom performance.monitor import get_metrics, track_performance\n\n# Import utilities\nfrom utils.error_handler import ErrorHandler, handle_errors, setup_logging\nfrom utils.types import DashboardData\n\n# Import views\nfrom views import VIEW_REGISTRY\nfrom views.base import ViewRegistry\n\n# Setup logging\nsetup_logging()\n\n# Page config\nst.set_page_config(\n    page_title=\"AI Adoption Dashboard | 2018-2025 Analysis\",\n    page_icon=\"ðŸ¤–\",\n    layout=\"wide\",\n    initial_sidebar_state=\"expanded\",\n    menu_items={\n        \"Get Help\": \"https://github.com/Rcasanova25/AI-Adoption-Dashboard/wiki\",\n        \"Report a bug\": \"https://github.com/Rcasanova25/AI-Adoption-Dashboard/issues\",\n        \"About\": \"# AI Adoption Dashboard\nVersion 2.2.0\n\nTrack AI adoption trends across industries and geographies.\",\n    },\n)\n\n# Initialize managers\na11y = create_accessible_dashboard_layout()\ntheme_manager = ThemeManager()\nerror_handler = ErrorHandler()\nview_registry = ViewRegistry()\n\n# Register all views\nfor view_name, view_func in VIEW_REGISTRY.items():\n    view_registry.register(view_name, view_func)\n\n\n# Initialize data manager\n@st.cache_resource\ndef init_data_manager():\n    \"\"\"Initialize the optimized data manager once per session.\"\"\"\n    return create_optimized_manager()\n\n\n# Data loading function\n@track_performance\n@st.cache_data\n@handle_errors(fallback_return={})\ndef load_data() -> DashboardData:\n    \"\"\"Load all dashboard data with caching and error handling.\"\"\"\n    data_manager = init_data_manager()\n\n    # Load data from various sources\n    data_sources = {\n        \"ai_index\": data_manager.get_data(\"ai_index\"),\n        \"mckinsey\": data_manager.get_data(\"mckinsey\"),\n        \"goldman_sachs\": data_manager.get_data(\"goldman_sachs\"),\n        \"nvidia\": data_manager.get_data(\"nvidia\"),\n        \"federal_reserve\": data_manager.get_data(\"federal_reserve\"),\n        \"oecd\": data_manager.get_data(\"oecd\"),\n        \"imf\": data_manager.get_data(\"imf\"),\n        \"academic\": data_manager.get_data(\"academic\"),\n    }\n\n    # Consolidate data for views\n    consolidated_data = {}\n\n    # Historical trends\n    consolidated_data[\"historical_data\"] = data_sources[\"ai_index\"] .get(\n        \"adoption_trends\", pd.DataFrame()\n    )\n\n    # Sector data\n    consolidated_data[\"sector_2018\"] = data_sources[\"ai_index\"] .get(\n        \"sector_adoption\", pd.DataFrame()\n    )\n    consolidated_data[\"sector_2025\"] = data_sources[\"mckinsey\"] .get(\"use_cases\", pd.DataFrame())\n\n    # Firm size\n    consolidated_data[\"firm_size\"] = data_sources[\"ai_index\"] .get(\"firm_size\", pd.DataFrame())\n\n    # AI maturity\n    consolidated_data[\"ai_maturity\"] = data_sources[\"ai_index\"] .get(\"ai_maturity\", pd.DataFrame())\n\n    # Geographic data\n    consolidated_data[\"geographic\"] = data_sources[\"ai_index\"] .get(\n        \"geographic_adoption\", pd.DataFrame()\n    )\n    consolidated_data[\"state_data\"] = data_sources[\"ai_index\"] .get(\"state_data\", pd.DataFrame())\n\n    # Financial data\n    consolidated_data[\"financial_impact\"] = data_sources[\"mckinsey\"] .get(\n        \"financial_impact\", pd.DataFrame()\n    )\n    consolidated_data[\"ai_investment_data\"] = data_sources[\"ai_index\"] .get(\n        \"investment_trends\", pd.DataFrame()\n    )\n\n    # Add all other data sources\n    for source_name, source_data in data_sources.items():\n        if isinstance(source_data, dict):\n            consolidated_data.update(source_data)\n\n    return consolidated_data\n\n\n# Initialize session state\ndef init_session_state():\n    \"\"\"Initialize session state variables.\"\"\"\n    defaults = {\n        \"first_visit\": True,\n        \"selected_persona\": \"General\",\n        \"show_changelog\": False,\n        \"selected_theme\": \"default\",\n        \"accessibility_mode\": False,\n    }\n\n    for key, default_value in defaults.items():\n        if key not in st.session_state:\n            st.session_state[key] = default_value\n\n\n# Main application\ndef main():\n    \"\"\"Main application entry point.\"\"\"\n    init_session_state()\n\n    # Apply theme\n    theme_manager.apply_theme(st.session_state.selected_theme)\n\n    # Load data\n    with st.spinner(\"Loading dashboard data...\"):\n        data = load_data()\n\n    if not data:\n        error_handler.display_error(\n            \"Unable to load dashboard data\",\n            \"Please check your internet connection and try again.\",\n            recovery_action=\"reload\",\n        )\n        return\n\n    # Title and description\n    st.title(\"ðŸ¤– AI Adoption Dashboard: 2018-2025\")\n    st.markdown(\n        \"**Comprehensive analysis from early AI adoption (2018) to current GenAI trends (2025)**\"\n    )\n\n    # Accessibility toolbar\n    a11y.render_accessibility_toolbar()\n\n    # Main navigation\n    st.markdown('<nav role=\"navigation\" aria-label=\"Dashboard navigation\">', unsafe_allow_html=True)\n\n    # Sidebar controls\n    with st.sidebar:\n        st.markdown(\n            '<aside role=\"complementary\" aria-label=\"Dashboard controls\">', unsafe_allow_html=True\n        )\n        st.header(\"ðŸ“Š Dashboard Controls\")\n\n        # Persona selector\n        persona = a11y.create_accessible_form_field(\n            field_type=\"select\",\n            label=\"Select Your Role\",\n            field_id=\"persona-selector\",\n            options=[\"General\", \"Business Leader\", \""Policymaker\", \"Researcher\"],\n            index=[\"General\", \"Business Leader\", \"Policymaker\", \"Researcher\"].index(\n                st.session_state.selected_persona\n            ),\n            key=\"persona-selector\",\n        )\n        st.session_state.selected_persona = persona\n\n        # View selector\n        view_names = list(VIEW_REGISTRY.keys())\n        selected_view = a11y.create_accessible_form_field(\n            field_type=\"select\",\n            label=\"Analysis View\",\n            field_id=\"view-selector\",\n            options=view_names,\n            key=\"view-selector\",\n        )\n\n        # Theme selector\n        theme = st.selectbox(\n            \"Theme\",\n            options=[\"default\", \"executive\", \"dark\", \"accessible\"],\n            index=[\"default\", \"executive\", \"dark\", \"accessible\"].index(\n                st.session_state.selected_theme\n            ),\n        )\n        if theme != st.session_state.selected_theme:\n            st.session_state.selected_theme = theme\n            st.rerun()\n\n        # Performance metrics\n        with st.expander(\"âš¡ Performance Metrics\"):\n            metrics = get_metrics()\n            if metrics:\n                col1, col2 = st.columns(2)\n                with col1:\n                    st.metric(\"Load Time\", f\"{metrics.get('load_time', 0):.2f}s\")\n                    st.metric(\"Memory\", f\"{metrics.get('memory_mb', 0):.1f} MB\")\n                with col2:\n                    st.metric(\"CPU\", f\"{metrics.get('cpu_percent', 0):.1f}%\")\n                    cache = get_cache()\n                    if cache:\n                        stats = cache.get_stats()\n                        st.metric(\"Cache Hit Rate\", f\"{stats.get('hit_rate', 0):.1%}\")\n\n        st.markdown(\"</aside>\", unsafe_allow_html=True)\n\n    # Key metrics\n    st.markdown('<section role=\"region\" aria-labelledby=\"key-metrics\">', unsafe_allow_html=True)\n    st.markdown('<h2 id=\"key-metrics\">ðŸ“ˆ Key Metrics</h2>', unsafe_allow_html=True)\n\n    col1, col2, col3, col4 = st.columns(4)\n\n    with col1:\n        render_metric_card(\n            label=\"AI Adoption\",\n            value=\"78%\",\n            delta=\"+23pp from 2023\",\n            insight=\"Includes any AI use\",\n            mode=\"compact\",\n        )\n\n    with col2:\n        render_metric_card(\n            label=\"GenAI Adoption\",\n            value=\"71%\",\n            delta=\"+38pp from 2023\",\n            insight=\"More than doubled\",\n            mode=\"compact\",\n        )\n\n    with col3:\n        render_metric_card(\n            label=\"2024 Investment\",\n            value=\"$252.3B\",\n            delta=\"+44.5% YoY\",\n            insight=\"Record levels\",\n            mode=\"compact\",\n        )\n\n    with col4:\n        render_metric_card(\n            label=\"Cost Reduction\",\n            value=\"280x\",\n            delta=\"Since Nov 2022\",\n            insight=\"AI inference costs\",\n            mode=\"compact\",\n        )\n\n    st.markdown(\"</section>\", unsafe_allow_html=True)\n\n    # Main content area\n    st.markdown('<main role=\"main\">', unsafe_allow_html=True)\n    st.markdown(f\"<h2>ðŸ“Š {selected_view}</h2>\", unsafe_allow_html=True)\n\n    # Render selected view with error boundary\n    try:\n        view_registry.render(selected_view, data)\n    except Exception as e:\n        error_handler.log_error(e, context={\"view\": selected_view})\n        error_handler.display_error(\n            f\"Error loading {selected_view}\",\n            \"We encountered an issue loading this view. Please try another view or refresh the page.\",\n            recovery_action=\"change_view\",\n        )\n\n    st.markdown(\"</main>\", unsafe_allow_html=True)\n\n    # Footer\n    st.markdown(\"---\")\n    st.markdown(\n        \"\"\"\n        <div style='text-align: center; color: #666; padding: 20px;'>\n            <p>ðŸ¤– AI Adoption Dashboard v2.2.0 | \n            Data sources: AI Index Report 2025, McKinsey, Goldman Sachs, OECD | \n            Created by Robert Casanova</p>\n        </div>\n        \"\"\",\n        unsafe_allow_html=True,\n    )\n\n\nif __name__ == \"__main__\":\n    main()\n